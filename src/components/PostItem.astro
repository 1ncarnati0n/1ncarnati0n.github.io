---
import { formatDate, getPostCategory, deriveTitle } from "../lib/content-utils";

interface Props {
  title?: string;
  slug: string;
  date?: Date;
  description?: string;
  tags?: string[];
}

const { title, slug, date, description, tags = [] } = Astro.props;
const displayTitle = deriveTitle(slug, title);
const category = getPostCategory(slug);
---

<a href={`/posts/${slug}/`} class="post-item">
  <div class="post-meta">
    <span class="post-category">{category}</span>
    {date && <time datetime={date.toISOString()}>{formatDate(date)}</time>}
  </div>
  <h3 class="post-title">{displayTitle}</h3>
  {description && <p class="post-desc">{description}</p>}
  {
    tags.length > 0 && (
      <div class="post-tags">
        {tags.slice(0, 3).map((tag) => (
          <span class="tag">#{tag}</span>
        ))}
      </div>
    )
  }
</a>

<style>
  .post-item {
    display: block;
    padding: var(--spacing-md) 0;
    border-bottom: 1px solid color-mix(in srgb, var(--gray) 15%, transparent);
    text-decoration: none;
    color: var(--text);
    transition: padding-left var(--transition);
  }
  .post-item:hover {
    padding-left: var(--spacing-sm);
    opacity: 1;
  }
  .post-meta {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    font-size: 0.8rem;
    color: var(--gray);
    margin-bottom: var(--spacing-xs);
    font-family: var(--font-header);
  }
  .post-category {
    background: color-mix(in srgb, var(--tertiary) 20%, transparent);
    padding: 1px 8px;
    border-radius: var(--radius-sm);
    font-size: 0.75rem;
    text-transform: capitalize;
  }
  .post-title {
    font-size: 1.1rem;
    margin-bottom: var(--spacing-xs);
    color: var(--text-heading);
  }
  .post-desc {
    font-size: 0.85rem;
    color: var(--gray);
    line-height: 1.5;
  }
  .post-tags {
    display: flex;
    gap: var(--spacing-sm);
    margin-top: var(--spacing-xs);
  }
  .tag {
    font-size: 0.75rem;
    color: var(--tertiary);
    font-family: var(--font-header);
  }
</style>
