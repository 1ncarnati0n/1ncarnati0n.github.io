---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import { getAllTags } from "../../lib/content-utils";

const allPosts = await getCollection("posts", ({ data }) => !data.draft);
const tags = getAllTags(allPosts);

// Count posts per tag
const tagCounts = new Map<string, number>();
allPosts.forEach((post) => {
  post.data.tags?.forEach((tag) => {
    tagCounts.set(tag, (tagCounts.get(tag) ?? 0) + 1);
  });
});
---

<BaseLayout title="Tags" description="전체 태그 목록">
  <div class="tags-page container">
    <h1 class="page-title">Tags</h1>
    <p class="page-desc">전체 태그 ({tags.length}개)</p>

    <div class="tag-cloud">
      {
        tags.map((tag) => (
          <a href={`/tags/${tag}/`} class="tag-chip">
            #{tag}
            <span class="tag-count">{tagCounts.get(tag)}</span>
          </a>
        ))
      }
    </div>
  </div>
</BaseLayout>

<style>
  .tags-page {
    padding-top: var(--spacing-xl);
    padding-bottom: var(--spacing-2xl);
    max-width: 800px;
  }
  .page-title {
    font-size: 2rem;
    margin-bottom: var(--spacing-xs);
  }
  .page-desc {
    color: var(--gray);
    margin-bottom: var(--spacing-xl);
  }
  .tag-cloud {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-sm);
  }
  .tag-chip {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-xs);
    padding: 6px 14px;
    border-radius: var(--radius-md);
    background: color-mix(in srgb, var(--gray) 10%, transparent);
    font-family: var(--font-header);
    font-size: 0.9rem;
    color: var(--text);
    text-decoration: none;
    transition: background var(--transition);
  }
  .tag-chip:hover {
    background: color-mix(in srgb, var(--tertiary) 25%, transparent);
    opacity: 1;
  }
  .tag-count {
    font-size: 0.75rem;
    color: var(--gray);
  }
</style>
