---
import BaseLayout from "../layouts/BaseLayout.astro";
import Hero from "../components/Hero.astro";
import ProjectCard from "../components/ProjectCard.astro";
import PostItem from "../components/PostItem.astro";
import { getCollection } from "astro:content";
import { sortPostsByDate, sortProjects, cleanSlug } from "../lib/content-utils";

const allProjects = await getCollection("projects");
const allPosts = await getCollection("posts", ({ data }) => !data.draft);

const projects = sortProjects(allProjects).slice(0, 8);
const recentPosts = sortPostsByDate(allPosts).slice(0, 5);
---

<BaseLayout>
  <Hero />

  <!-- Projects Section -->
  <section class="section container">
    <div class="section-header">
      <h2>Projects</h2>
      <a href="/projects/" class="view-all">View All &rarr;</a>
    </div>
    <div class="project-grid">
      {
        projects.map((project) => (
          <ProjectCard
            title={project.data.title}
            slug={cleanSlug(project.id)}
            thumbnail={project.data.thumbnail}
            category={project.data.category}
            description={project.data.description}
          />
        ))
      }
    </div>
  </section>

  <!-- Recent Posts Section -->
  <section class="section container">
    <div class="section-header">
      <h2>Recent Posts</h2>
      <a href="/posts/" class="view-all">View All &rarr;</a>
    </div>
    <div class="post-list">
      {
        recentPosts.map((post) => (
          <PostItem
            title={post.data.title}
            slug={cleanSlug(post.id)}
            date={post.data.date}
            description={post.data.description}
            tags={post.data.tags}
          />
        ))
      }
    </div>
  </section>
</BaseLayout>

<style>
  .section {
    margin-bottom: var(--spacing-2xl);
  }
  .section-header {
    display: flex;
    align-items: baseline;
    justify-content: space-between;
    margin-bottom: var(--spacing-lg);
  }
  .section-header h2 {
    font-size: 1.5rem;
  }
  .view-all {
    font-size: 0.85rem;
    font-family: var(--font-header);
    color: var(--gray);
  }
  .view-all:hover {
    color: var(--text);
    opacity: 1;
  }
  .project-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: var(--spacing-lg);
  }
  @media (max-width: 1024px) {
    .project-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }
  @media (max-width: 600px) {
    .project-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
